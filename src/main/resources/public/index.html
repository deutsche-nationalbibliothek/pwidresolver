<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel='stylesheet' href='/webjars/bootstrap/css/bootstrap.min.css'>
        <script src='/webjars/jquery/jquery.min.js'></script>
    </head>
    <body>
        <main>
            <div class="container py-4">
                <div class="row">
                    <div class="col-md-12">
                        <h1>PWID Resolver</h1>
                        This tool helps to resolve <a href="https://datatracker.ietf.org/doc/draft-pwid-urn-specification/09/">PWID URNs</a>.
                    </div>
                </div>
                <div class="card-text">
                    <div class="row">
                        <div class="col-md-12">
                            <form id="PwidForm" action="" class="p-3 bg-light was-validated" novalidate="">
                                <div class="row no-gutters align-items-center form-group position-relative">
                                    <div class="col-md-12">
                                            <input type="text" class="form-control form-control-lg form-control-borderless" id="archiveString" placeholder="urn:pwid:webarchiv.onb.ac.at:2019-01-01T14:37:20Z:part:https://www.onb.ac.at/museen/papyrusmuseum/" required="">
                                            <span class="form-clear d-none"><i class="fa fa-times-circle"></i></span>
                                            <div class="valid-feedback">
                                            </div>

                                            <div class="invalid-feedback">
                                                Bitte PWID oder Webarchiv URI eingeben!
                                            </div>
                                        </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                            <button type="submit" class="btn btn-lg btn-outline-primary" id="pwidsubmit">AuflÃ¶sen</button>
                                        </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div id="resolve_results">
                    <p></p><h5>Replay</h5><p></p>
                    <div class="col-md-12">
                        <div class="row">
                        <div class="col-md-10" id="replay_url"></div>
                        <div class="col-md-2 bookmarkable" id="replay_url_copy"></div>
                        </div>
                    </div>
                    <p></p><h5>PWID</h5><p></p>
                    <div class="col-md-12">
                        <div class="row">
                        <div class="col-md-10" id="resolve_result"></div>
                        <div class="col-md-2 bookmarkable" id="resolve_result_copy"></div>
                        </div>
                    </div>
                    <p></p><h5>Resolver URL</h5><p></p>
                    <div class="col-md-12">
                        <div class="row">
                        <div class="col-md-10" id="resolver_url"></div>
                        <div class="col-md-2" id="resolver_url_copy"></div>
                        </div>
                    </div>
                    <p></p><h5>Resolver URL HTML</h5><p></p>
                    <div class="col-md-12">
                        <div class="row">
                        <pre class="col-md-10"><code id="resolve_result_htmlcode"></code></pre>
                        <div class="col-md-2" id="resolve_result_htmlcode_copy"></div>
                        </div>
                    </div>
                </div>

                <footer class="pt-3 mt-4 text-muted border-top">
                    Find the code at <a href="https://github.com/deutsche-nationalbibliothek/pwidresolver">pwidresolver</a>.
                </footer>
            </div>
        </main>
        <script type="application/javascript">
            my_archive_id = "webarchiv.dnb.de";
            jQuery("#resolve_results").hide();
            jQuery("#pwidsubmit").on("click",function(e) {
                e.preventDefault(), checkPwidStringContent();
                var t = jQuery("#PwidForm")[0];
                return t.checkValidity() ? (t.classList.add("was-validated"), t = jQuery("#archiveString").val(), jQuery.ajax({
                    url: getApiPath() + "?archiveString=" + encodeURIComponent(t),
                    headers: {
                    },
                    data: t,
                    dataType: "json",
                    contentType: "application/json",
                        success: function(e) {

                        addAlert("#alerts", "PWID wurde erfolgreich erzeugt", "alert-success", 1e3);

                        let archive_id = e.archiveId;
                        let replay_url = e.resolvedUrl;
                        let pwid = e.urn
                        let resolver_url = e.resolvingUri;

                        replay_url_html = `<a target="_blank" href="${replay_url}">${replay_url}</a>`
                        resolve_result_html = `<a target="_blank" href="${resolver_url}">${pwid}</a>`
                        resolver_url_html = `<a target="_blank" href="${resolver_url}">${resolver_url}</a>`

                        $("#replay_url").html(replay_url_html);
                        $("#resolve_result").html(resolve_result_html);
                        $("#resolver_url").html(resolver_url_html);
                        $("#resolve_result_htmlcode").text(resolve_result_html);

                        $("#replay_url_copy").html(getCopyButtonHtml(replay_url, "Replay Link in die Zwischenablage kopieren"))
                        $("#resolve_result_copy").html(getCopyButtonHtml(pwid, "PWID in die Zwischenablage kopieren"))
                        $("#resolver_url_copy").html(getCopyButtonHtml(resolver_url, "Resolver Link in die Zwischenablage kopieren"))
                        $("#resolve_result_htmlcode_copy").html(getCopyButtonHtml(resolve_result_html, "PWID in die Zwischenablage kopieren"))

                        $("#resolve_results").show()
                    },
                    error: function(e) {
                        addAlert("#alerts", "PWID konnte nicht erzeugt werden", "alert-danger", -1)
                    }
                })) : (e.preventDefault(), e.stopPropagation()), !1
            })
            function getCopyButtonHtml(content, title) {
                return `<button class="btn" data-toggle="tooltip" data-placement="top" title="${title}" data-clipboard-action="copy" data-clipboard-target="div" data-clipboard-text="${escapeHtml(content)}">ðŸ“‹</button>`
            }
            function checkPwidStringContent(){
                ""==$("#archiveString").val()?($("#archiveString").addClass("is-invalid"),$("#pwidsubmit").prop("disabled",!0)):($("#archiveString").removeClass("is-invalid"),$("#pwidsubmit").prop("disabled",!1))
            }
            function getApiPath() {
                return "http://localhost:8080/pwid"
            }
            function addAlert() {

            }
            function escapeHtml(html) {
                var text = document.createTextNode(html);
                var p = document.createElement('p');
                p.appendChild(text);
                return p.innerHTML;
            }
        </script>
    </body>
</html>